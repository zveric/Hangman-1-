This code is a total mess.